@using DevOpsAssistant.Services.Models
@using Microsoft.AspNetCore.Components.Forms
@using Microsoft.Extensions.Localization
@inject IStringLocalizer<WikiDocumentSelector> L

<MudTooltip Text='@L["UseDocumentTooltip"]'>
    <MudSwitch T="bool" @bind-Value="UseDocument" Color="Color.Primary" Label="Use Document" />
</MudTooltip>
@if (UseDocument)
{
    <InputFile OnChange="OnFileSelected" accept=".pdf,.docx,.pptx,.md" />
}
else if (WikiItems != null)
{
    <MudTreeView T="WikiPageNode"
                 Items="@WikiItems"
                 SelectionMode="SelectionMode.MultiSelection"
                 SelectedValues="@SelectedPages"
                 SelectedValuesChanged="@(pages => OnSelectedPagesChanged(pages))"
                 Class="scroll-300">
        <ItemTemplate>
            <MudTreeViewItem Items="@context.Children" Value="@context.Value" Text="@context.Text" @bind-Expanded="@context.Expanded" />
        </ItemTemplate>
    </MudTreeView>
}

@code {
    [Parameter] public bool UseDocument { get; set; }
    [Parameter] public EventCallback<bool> UseDocumentChanged { get; set; }
    [Parameter] public IBrowserFile? File { get; set; }
    [Parameter] public EventCallback<IBrowserFile?> FileChanged { get; set; }
    [Parameter] public List<TreeItemData<WikiPageNode>>? WikiItems { get; set; }
    [Parameter] public IReadOnlyCollection<WikiPageNode>? SelectedPages { get; set; }
    [Parameter] public EventCallback<IReadOnlyCollection<WikiPageNode>?> SelectedPagesChanged { get; set; }

    private Task OnFileSelected(InputFileChangeEventArgs e)
    {
        File = e.File;
        return FileChanged.InvokeAsync(File);
    }

    private Task OnSelectedPagesChanged(IReadOnlyCollection<WikiPageNode> pages)
    {
        SelectedPages = pages;
        return SelectedPagesChanged.InvokeAsync(SelectedPages);
    }
}
